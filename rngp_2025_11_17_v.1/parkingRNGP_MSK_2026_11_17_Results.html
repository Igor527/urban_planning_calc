<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –º–∞—à–∏–Ω–æ–º–µ—Å—Ç –ø–æ ‚Ññ945-–ü–ü</title>
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <script src="parkingCalculator.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            line-height: 1.6;
            background-color: #f9f9f9;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input, select {
            width: 100%;
            padding: 8px;
            box-sizing: border-box;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .results {
            margin-top: 30px;
            padding: 15px;
            background: #f5f5f5;
            border-radius: 5px;
            white-space: pre-wrap;
            font-family: monospace;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
        .section {
            margin-bottom: 20px;
            padding: 15px;
            background: #f0f8ff;
            border-radius: 5px;
        }
        .ui-autocomplete {
            max-height: 200px;
            overflow-y: auto;
            overflow-x: hidden;
        }
        .initial-values {
            margin-top: 20px;
            padding: 15px;
            background: #e6f7ff;
            border-radius: 5px;
        }
        #fullAddressRow {
            margin-bottom: 1rem;
            padding: 0.75rem;
            background: #f0f2f5;
            border-radius: 8px;
            border-left: 4px solid #10adff;
            font-size: 0.9rem;
        }
        #fullAddressOutput {
            font-weight: 600;
            color: #333;
        }
        #yandexLinkContainer {
            margin-bottom: 1.5rem;
        }
        .yandex-card {
            padding: 1rem;
            background: #f8f9fa;
            border: 1px dashed #bbc1c7;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .yandex-btn {
            background-color: #ffcc00 !important;
            color: #000 !important;
            border: none !important;
            padding: 8px 16px !important;
            font-weight: 600 !important;
            text-decoration: none !important;
            border-radius: 6px !important;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        .bulk-paste-modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }
        .bulk-paste-content {
            background-color: #fefefe;
            margin: 5% auto;
            padding: 30px;
            border: 1px solid #888;
            border-radius: 8px;
            width: 80%;
            max-width: 600px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .bulk-paste-close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            line-height: 20px;
        }
        .bulk-paste-close:hover,
        .bulk-paste-close:focus {
            color: #000;
        }
        #bulkPasteArea {
            width: 100%;
            min-height: 300px;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            resize: vertical;
            margin-bottom: 15px;
        }
        .bulk-paste-hint {
            background: #f0f8ff;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 15px;
            border-left: 4px solid #4CAF50;
        }
        .bulk-paste-hint h4 {
            margin-top: 0;
            color: #2c5282;
        }
        .bulk-paste-hint ol {
            margin: 10px 0;
            padding-left: 20px;
            color: #666;
            line-height: 1.8;
        }
        .btn-paste {
            background-color: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
        }
        .btn-paste:hover {
            background-color: #45a049;
        }
        .btn-open-bulk {
            background-color: #2196F3;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            margin-bottom: 15px;
        }
        .btn-open-bulk:hover {
            background-color: #0b7dda;
        }
        .btn-copy-report {
            background-color: #FF9800;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            margin-left: 10px;
        }
        .btn-copy-report:hover {
            background-color: #F57C00;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –º–∞—à–∏–Ω–æ–º–µ—Å—Ç –ø–æ ‚Ññ945-–ü–ü</h1>
        
        <button class="btn-open-bulk" onclick="openBulkPasteModal()">üìã –í—Å—Ç–∞–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ —Å–ø–∏—Å–∫–æ–º</button>
        <button class="btn-copy-report" onclick="copyReportToClipboard()">üìÑ –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –æ—Ç—á—ë—Ç</button>

        <div class="section">
            <h3>–û–±—â–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã</h3>
            
            <div class="form-group">
                <label for="objName">–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞:</label>
                <input type="text" id="objName" placeholder="–ù–∞–ø—Ä: –ñ–ö '–°—Ç—Ä–æ–≥–∏–Ω–æ'">
            </div>

            <div class="form-group">
                <label for="objAddress">–ü–æ–∏—Å–∫ –ø–æ –∞–¥—Ä–µ—Å—É:</label>
                <input type="text" id="objAddress" placeholder="–ù–∞–ø—Ä: —É–ª. –ú–∞—Ä—à–∞–ª–∞ –ö–∞—Ç—É–∫–æ–≤–∞, 24">
                <small style="color: #666; margin-top: 5px; display: block;">–†–∞–π–æ–Ω –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –≤–≤–æ–¥–µ –∞–¥—Ä–µ—Å–∞</small>
            </div>

            <div id="fullAddressRow" style="display: none;">
                <small style="color: #666; display: block; margin-bottom: 2px;">–ü–æ–ª–Ω—ã–π –∞–¥—Ä–µ—Å –æ–±—ä–µ–∫—Ç–∞ (–ø–æ–ª—É—á–µ–Ω –ø–æ –ì–ò–°):</small>
                <div id="fullAddressOutput">–û–∂–∏–¥–∞–Ω–∏–µ –≤–≤–æ–¥–∞ –∞–¥—Ä–µ—Å–∞...</div>
            </div>

            <div id="yandexLinkContainer"></div>

            <div class="form-group">
                <label for="districtName">–†–∞–π–æ–Ω:</label>
                <input type="text" id="districtName" placeholder="–í—ã–±–µ—Ä–∏—Ç–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ" value="">
            </div>

            <div class="form-group">
                <label>–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –¢–¢–ö:</label>
                <select id="ttkStatus">
                    <option value="" disabled selected>–í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ</option>
                    <option value="inside">–í–Ω—É—Ç—Ä–∏ –¢–¢–ö</option>
                    <option value="outside">–°–Ω–∞—Ä—É–∂–∏ –¢–¢–ö</option>
                </select>
            </div>

            <div class="form-group">
                <label for="metroDistance">–£–¥–∞–ª—ë–Ω–Ω–æ—Å—Ç—å –æ—Ç –º–µ—Ç—Ä–æ (–º–µ—Ç—Ä—ã):</label>
                <input type="number" id="metroDistance" value="0" placeholder="0">
            </div>

            <div class="form-group">
                <label for="rnsYear">–ì–æ–¥ –†–ù–°:</label>
                <select id="rnsYear">
                    <option value="" disabled selected>–í—ã–±–µ—Ä–∏—Ç–µ –≥–æ–¥</option>
                    <option value="2025">2025</option>
                    <option value="2026">2026</option>
                    <option value="2027">2027</option>
                </select>
            </div>
        </div>

        <div class="section">
            <h3>–ñ–∏–ª–æ–π –æ–±—ä–µ–∫—Ç</h3>
            <div class="form-group">
                <label for="areaFlats">–ü–ª–æ—â–∞–¥—å –∫–≤–∞—Ä—Ç–∏—Ä (–∫–≤.–º):</label>
                <input type="number" id="areaFlats" value="0" step="0.1">
            </div>
        </div>

        <div class="section">
            <h3>–ö–æ–º–º–µ—Ä—á–µ—Å–∫–∏–π –æ–±—ä–µ–∫—Ç</h3>
            <div class="form-group">
                <label for="areaNNP">–ù–µ–∂–∏–ª–∞—è –Ω–∞–∑–µ–º–Ω–∞—è –ø–ª–æ—â–∞–¥—å (–∫–≤.–º):</label>
                <input type="number" id="areaNNP" value="0" step="0.1">
            </div>
        </div>

        <div class="section">
            <h3>–®–∫–æ–ª–∞</h3>
            <div class="form-group">
                <label for="schoolCapacity">–í–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —à–∫–æ–ª—ã (—á–µ–ª.):</label>
                <input type="number" id="schoolCapacity" value="0">
            </div>
        </div>

        <div class="section">
            <h3>–î–µ—Ç—Å–∫–∏–π —Å–∞–¥</h3>
            <div class="form-group">
                <label for="kindergartenCapacity">–í–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –¥–µ—Ç—Å–∫–æ–≥–æ —Å–∞–¥–∞ (—á–µ–ª.):</label>
                <input type="number" id="kindergartenCapacity" value="0">
            </div>
        </div>

        <div class="section">
            <h3>–§–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –º–µ—Å—Ç–∞</h3>
            <div class="form-group">
                <label>–ù–∞ —É—á–∞—Å—Ç–∫–µ:</label>
                <div style="margin-left: 20px;">
                    <div style="margin-bottom: 10px;">
                        <label for="fact_zu_mo">–ú–µ—Å—Ç–∞ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏:</label>
                        <input type="number" id="fact_zu_mo" value="0">
                    </div>
                    <div style="margin-bottom: 10px;">
                        <label for="fact_zu_guest_mgn">–ì–æ—Å—Ç–µ–≤—ã–µ –ú–ì–ù:</label>
                        <input type="number" id="fact_zu_guest_mgn" value="0">
                    </div>
                    <div style="margin-bottom: 10px;">
                        <label for="fact_zu_priob_mgn">–ü—Ä–∏–æ–±—ä–µ–∫—Ç–Ω—ã–µ –ú–ì–ù:</label>
                        <input type="number" id="fact_zu_priob_mgn" value="0">
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label>–ù–∞ –£–î–°:</label>
                <div style="margin-left: 20px;">
                    <div style="margin-bottom: 10px;">
                        <label for="fact_uds_mo">–ú–µ—Å—Ç–∞ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏:</label>
                        <input type="number" id="fact_uds_mo" value="0">
                    </div>
                    <div style="margin-bottom: 10px;">
                        <label for="fact_uds_guest">–ì–æ—Å—Ç–µ–≤—ã–µ:</label>
                        <input type="number" id="fact_uds_guest" value="0">
                    </div>
                    <div style="margin-bottom: 10px;">
                        <label for="fact_uds_guest_mgn">–ì–æ—Å—Ç–µ–≤—ã–µ –ú–ì–ù:</label>
                        <input type="number" id="fact_uds_guest_mgn" value="0">
                    </div>
                    <div style="margin-bottom: 10px;">
                        <label for="fact_uds_priob">–ü—Ä–∏–æ–±—ä–µ–∫—Ç–Ω—ã–µ:</label>
                        <input type="number" id="fact_uds_priob" value="0">
                    </div>
                    <div style="margin-bottom: 10px;">
                        <label for="fact_uds_priob_mgn">–ü—Ä–∏–æ–±—ä–µ–∫—Ç–Ω—ã–µ –ú–ì–ù:</label>
                        <input type="number" id="fact_uds_priob_mgn" value="0">
                    </div>
                </div>
            </div>
        </div>

        <div class="initial-values">
            <h3>–ò—Å—Ö–æ–¥–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:</h3>
            <pre id="initialValues"></pre>
        </div>

        <div class="results" id="results"></div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –º–∞—Å—Å–æ–≤–æ–π –≤—Å—Ç–∞–≤–∫–∏ -->
    <div id="bulkPasteModal" class="bulk-paste-modal">
        <div class="bulk-paste-content">
            <span class="bulk-paste-close" onclick="closeBulkPasteModal()">&times;</span>
            <h2>üìã –ú–∞—Å—Å–æ–≤–∞—è –≤—Å—Ç–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö</h2>
            
            <div class="bulk-paste-hint">
                <h4>–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ –≤—Å—Ç–∞–≤–∫–∏:</h4>
                <ol>
                    <li>–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä: –ñ–ö '–°—Ç—Ä–æ–≥–∏–Ω–æ')</li>
                    <li>–ê–¥—Ä–µ—Å (–Ω–∞–ø—Ä–∏–º–µ—Ä: —É–ª. –ú–∞—Ä—à–∞–ª–∞ –ö–∞—Ç—É–∫–æ–≤–∞, 24)</li>
                    <li>–†–∞–π–æ–Ω (–Ω–∞–ø—Ä–∏–º–µ—Ä: –°—Ç—Ä–æ–≥–∏–Ω–æ)</li>
                    <li>–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –¢–¢–ö (–í–Ω—É—Ç—Ä–∏ –¢–¢–ö / –°–Ω–∞—Ä—É–∂–∏ –¢–¢–ö)</li>
                    <li>–£–¥–∞–ª—ë–Ω–Ω–æ—Å—Ç—å –æ—Ç –º–µ—Ç—Ä–æ (–≤ –º–µ—Ç—Ä–∞—Ö, –Ω–∞–ø—Ä–∏–º–µ—Ä: 2300)</li>
                    <li>–ì–æ–¥ –†–ù–° (–Ω–∞–ø—Ä–∏–º–µ—Ä: 2026)</li>
                    <li>–ü–ª–æ—â–∞–¥—å –∫–≤–∞—Ä—Ç–∏—Ä (–∫–≤.–º, –Ω–∞–ø—Ä–∏–º–µ—Ä: 51539.3)</li>
                    <li>–ù–µ–∂–∏–ª–∞—è –Ω–∞–∑–µ–º–Ω–∞—è –ø–ª–æ—â–∞–¥—å - –ù–ù–ü (–∫–≤.–º, –Ω–∞–ø—Ä–∏–º–µ—Ä: 4048)</li>
                    <li>–í–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —à–∫–æ–ª—ã (—á–µ–ª., –Ω–∞–ø—Ä–∏–º–µ—Ä: 1250 –∏–ª–∏ 0)</li>
                    <li>–í–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –¥–µ—Ç—Å–∫–æ–≥–æ —Å–∞–¥–∞ (—á–µ–ª., –Ω–∞–ø—Ä–∏–º–µ—Ä: 425 –∏–ª–∏ 0)</li>
                    <li style="color: #999; font-style: italic;">–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –§–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –º–µ—Å—Ç–∞ –Ω–∞ –ó–£ - –ú–û (—à—Ç.)</li>
                    <li style="color: #999; font-style: italic;">–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –§–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –º–µ—Å—Ç–∞ –Ω–∞ –ó–£ - –ì–æ—Å—Ç–µ–≤—ã–µ –ú–ì–ù (—à—Ç.)</li>
                    <li style="color: #999; font-style: italic;">–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –§–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –º–µ—Å—Ç–∞ –Ω–∞ –ó–£ - –ü—Ä–∏–æ–±—ä–µ–∫—Ç–Ω—ã–µ –ú–ì–ù (—à—Ç.)</li>
                    <li style="color: #999; font-style: italic;">–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –§–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –º–µ—Å—Ç–∞ –Ω–∞ –£–î–° - –ú–û (—à—Ç.)</li>
                    <li style="color: #999; font-style: italic;">–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –§–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –º–µ—Å—Ç–∞ –Ω–∞ –£–î–° - –ì–æ—Å—Ç–µ–≤—ã–µ (—à—Ç.)</li>
                    <li style="color: #999; font-style: italic;">–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –§–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –º–µ—Å—Ç–∞ –Ω–∞ –£–î–° - –ì–æ—Å—Ç–µ–≤—ã–µ –ú–ì–ù (—à—Ç.)</li>
                    <li style="color: #999; font-style: italic;">–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –§–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –º–µ—Å—Ç–∞ –Ω–∞ –£–î–° - –ü—Ä–∏–æ–±—ä–µ–∫—Ç–Ω—ã–µ (—à—Ç.)</li>
                    <li style="color: #999; font-style: italic;">–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –§–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –º–µ—Å—Ç–∞ –Ω–∞ –£–î–° - –ü—Ä–∏–æ–±—ä–µ–∫—Ç–Ω—ã–µ –ú–ì–ù (—à—Ç.)</li>
                </ol>
                <small style="color: #666;">
                    üí° –í—Å—Ç–∞–≤—å—Ç–µ –¥–∞–Ω–Ω—ã–µ –ø–æ—Å—Ç—Ä–æ—á–Ω–æ. –ú–æ–∂–Ω–æ –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∏–∑ Excel (–æ–¥–∏–Ω —Å—Ç–æ–ª–±–µ—Ü).
                    <br>–ü—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏ –∏ –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –ø–æ–ª—è –±—É–¥—É—Ç –ø—Ä–æ–ø—É—â–µ–Ω—ã.
                </small>
            </div>
            
            <textarea id="bulkPasteArea" placeholder="–ñ–ö '–°—Ç—Ä–æ–≥–∏–Ω–æ'
—É–ª. –ú–∞—Ä—à–∞–ª–∞ –ö–∞—Ç—É–∫–æ–≤–∞, 24
–°—Ç—Ä–æ–≥–∏–Ω–æ
–°–Ω–∞—Ä—É–∂–∏ –¢–¢–ö
2300
2026
51539.3
4048
1250
425"></textarea>
            
            <button class="btn-paste" onclick="processBulkPaste()">‚úÖ –ü—Ä–∏–º–µ–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ</button>
        </div>
    </div>

    <script>
        $(function() {
            const districts = Object.keys(parkingData.districts);
            $("#districtName").autocomplete({
                source: districts
            });
            
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ—Å—á–µ—Ç –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ª—é–±–æ–≥–æ –ø–æ–ª—è
            $('input, select').on('input change', function() {
                recalculate();
            });

            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–≤–æ–¥–∞ –∞–¥—Ä–µ—Å–∞ —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π –¥–ª—è –∞–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ä–∞–π–æ–Ω–∞
            let addressTimeout;
            $('#objAddress').on('input', function() {
                clearTimeout(addressTimeout);
                const address = $(this).val().trim();
                
                if (address.length > 3) {
                    addressTimeout = setTimeout(() => {
                        geocodeAddress(address);
                    }, 500);
                } else {
                    $('#fullAddressRow').hide();
                    $('#yandexLinkContainer').empty();
                }
            });
        });

        // –§—É–Ω–∫—Ü–∏—è –≥–µ–æ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è –∞–¥—Ä–µ—Å–∞ —á–µ—Ä–µ–∑ –Ø–Ω–¥–µ–∫—Å API
        async function geocodeAddress(address) {
            try {
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø—É–±–ª–∏—á–Ω—ã–π API –Ø–Ω–¥–µ–∫—Å –ì–µ–æ–∫–æ–¥–µ—Ä–∞ —á–µ—Ä–µ–∑ suggest
                const encodedAddress = encodeURIComponent('–ú–æ—Å–∫–≤–∞, ' + address);
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Å—ã–ª–∫—É –Ω–∞ –Ø–Ω–¥–µ–∫—Å.–ö–∞—Ä—Ç—ã –¥–∞–∂–µ –±–µ–∑ –≥–µ–æ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è
                const searchUrl = `https://yandex.ru/maps/?text=${encodedAddress}`;
                $('#yandexLinkContainer').html(`
                    <div class="yandex-card">
                        <span>üìç –ù–∞–π—Ç–∏ –∞–¥—Ä–µ—Å –Ω–∞ –∫–∞—Ä—Ç–µ</span>
                        <a href="${searchUrl}" target="_blank" class="yandex-btn">–Ø–Ω–¥–µ–∫—Å.–ö–∞—Ä—Ç—ã</a>
                    </div>
                `);
                $('#fullAddressOutput').text('–í–≤–µ–¥–µ–Ω –∞–¥—Ä–µ—Å: ' + address);
                $('#fullAddressRow').show();
                
                // –ü—ã—Ç–∞–µ–º—Å—è –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ä–∞–π–æ–Ω –∏–∑ —Ç–µ–∫—Å—Ç–∞ –∞–¥—Ä–µ—Å–∞
                const districts = Object.keys(parkingData.districts);
                const matchingDistrict = districts.find(d => 
                    address.toLowerCase().includes(d.toLowerCase())
                );
                
                if (matchingDistrict && !$('#districtName').val()) {
                    $('#districtName').val(matchingDistrict);
                    $('#districtName').trigger('change');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∞–¥—Ä–µ—Å–∞:', error);
            }
        }

        function recalculate() {
            const districtName = document.getElementById('districtName').value;
            const ttkStatus = document.getElementById('ttkStatus').value;
            const metroDistance = parseFloat(document.getElementById('metroDistance').value);
            const rnsYear = parseInt(document.getElementById('rnsYear').value);

            const inputData = {
                objName: document.getElementById('objName').value,
                districtName: districtName,
                ttkStatus: ttkStatus,
                metroDistance: metroDistance,
                rnsYear: rnsYear,
                areaFlats: parseFloat(document.getElementById('areaFlats').value),
                areaNNP: parseFloat(document.getElementById('areaNNP').value),
                schoolCapacity: parseInt(document.getElementById('schoolCapacity').value),
                kindergartenCapacity: parseInt(document.getElementById('kindergartenCapacity').value),
                fact_zu_mo: parseInt(document.getElementById('fact_zu_mo').value),
                fact_zu_guest_mgn: parseInt(document.getElementById('fact_zu_guest_mgn').value),
                fact_zu_priob_mgn: parseInt(document.getElementById('fact_zu_priob_mgn').value),
                fact_uds_mo: parseInt(document.getElementById('fact_uds_mo').value),
                fact_uds_guest: parseInt(document.getElementById('fact_uds_guest').value),
                fact_uds_guest_mgn: parseInt(document.getElementById('fact_uds_guest_mgn').value),
                fact_uds_priob: parseInt(document.getElementById('fact_uds_priob').value),
                fact_uds_priob_mgn: parseInt(document.getElementById('fact_uds_priob_mgn').value)
            };

            const calculator = new ParkingCalculator(inputData);
            calculator.calculate();
            const report = calculator.getFormattedReport();

            document.getElementById('results').innerHTML = report;
            
            // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –≤—ã–≤–æ–¥ –∏—Å—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
            const objName = document.getElementById('objName').value;
            const objAddress = document.getElementById('objAddress').value;
            let formattedData = '';
            
            if (objName) formattedData += `–û–±—ä–µ–∫—Ç: ${objName}\n`;
            if (objAddress) formattedData += `–ê–¥—Ä–µ—Å: ${objAddress}\n`;
            if (districtName) formattedData += `–†–∞–π–æ–Ω: ${districtName}\n`;
            if (ttkStatus) formattedData += `–¢–¢–ö: ${ttkStatus === 'inside' ? '–í–Ω—É—Ç—Ä–∏' : '–°–Ω–∞—Ä—É–∂–∏'}\n`;
            if (!isNaN(metroDistance)) formattedData += `–ú–µ—Ç—Ä–æ: ${metroDistance} –º\n`;
            if (!isNaN(rnsYear)) formattedData += `–ì–æ–¥ –†–ù–°: ${rnsYear}\n`;
            if (!isNaN(inputData.areaFlats) && inputData.areaFlats > 0) formattedData += `–ü–ª–æ—â–∞–¥—å –∫–≤–∞—Ä—Ç–∏—Ä: ${inputData.areaFlats} –∫–≤.–º\n`;
            if (!isNaN(inputData.areaNNP) && inputData.areaNNP > 0) formattedData += `–ù–ù–ü: ${inputData.areaNNP} –∫–≤.–º\n`;
            if (!isNaN(inputData.schoolCapacity) && inputData.schoolCapacity > 0) formattedData += `–®–∫–æ–ª–∞: ${inputData.schoolCapacity} —á–µ–ª.\n`;
            if (!isNaN(inputData.kindergartenCapacity) && inputData.kindergartenCapacity > 0) formattedData += `–î–µ—Ç—Å–∞–¥: ${inputData.kindergartenCapacity} —á–µ–ª.\n`;
            
            // –§–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –º–µ—Å—Ç–∞ (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –µ—Å—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è)
            const hasFacts = inputData.fact_zu_mo || inputData.fact_zu_guest_mgn || inputData.fact_zu_priob_mgn ||
                            inputData.fact_uds_mo || inputData.fact_uds_guest || inputData.fact_uds_guest_mgn ||
                            inputData.fact_uds_priob || inputData.fact_uds_priob_mgn;
            
            if (hasFacts) {
                formattedData += `\n–§–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –º–µ—Å—Ç–∞:\n`;
                if (inputData.fact_zu_mo) formattedData += `  –ó–£ –ú–û: ${inputData.fact_zu_mo} —à—Ç.\n`;
                if (inputData.fact_zu_guest_mgn) formattedData += `  –ó–£ –ì–æ—Å—Ç–µ–≤—ã–µ –ú–ì–ù: ${inputData.fact_zu_guest_mgn} —à—Ç.\n`;
                if (inputData.fact_zu_priob_mgn) formattedData += `  –ó–£ –ü—Ä–∏–æ–±—ä–µ–∫—Ç–Ω—ã–µ –ú–ì–ù: ${inputData.fact_zu_priob_mgn} —à—Ç.\n`;
                if (inputData.fact_uds_mo) formattedData += `  –£–î–° –ú–û: ${inputData.fact_uds_mo} —à—Ç.\n`;
                if (inputData.fact_uds_guest) formattedData += `  –£–î–° –ì–æ—Å—Ç–µ–≤—ã–µ: ${inputData.fact_uds_guest} —à—Ç.\n`;
                if (inputData.fact_uds_guest_mgn) formattedData += `  –£–î–° –ì–æ—Å—Ç–µ–≤—ã–µ –ú–ì–ù: ${inputData.fact_uds_guest_mgn} —à—Ç.\n`;
                if (inputData.fact_uds_priob) formattedData += `  –£–î–° –ü—Ä–∏–æ–±—ä–µ–∫—Ç–Ω—ã–µ: ${inputData.fact_uds_priob} —à—Ç.\n`;
                if (inputData.fact_uds_priob_mgn) formattedData += `  –£–î–° –ü—Ä–∏–æ–±—ä–µ–∫—Ç–Ω—ã–µ –ú–ì–ù: ${inputData.fact_uds_priob_mgn} —à—Ç.\n`;
            }
            
            document.getElementById('initialValues').textContent = formattedData || '–î–∞–Ω–Ω—ã–µ –Ω–µ –∑–∞–ø–æ–ª–Ω–µ–Ω—ã';
        }

        window.onload = function() {
            recalculate();
        };

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –º–∞—Å—Å–æ–≤–æ–π –≤—Å—Ç–∞–≤–∫–∏
        function openBulkPasteModal() {
            document.getElementById('bulkPasteModal').style.display = 'block';
        }

        function closeBulkPasteModal() {
            document.getElementById('bulkPasteModal').style.display = 'none';
        }

        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø–æ –∫–ª–∏–∫—É –≤–Ω–µ –µ–≥–æ
        window.onclick = function(event) {
            const modal = document.getElementById('bulkPasteModal');
            if (event.target == modal) {
                closeBulkPasteModal();
            }
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –º–∞—Å—Å–æ–≤–æ–π –≤—Å—Ç–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö
        function processBulkPaste() {
            const text = document.getElementById('bulkPasteArea').value;
            const lines = text.split(/\r?\n/).map(line => line.trim()).filter(line => line);
            
            if (lines.length === 0) {
                alert('‚ö†Ô∏è –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—Å—Ç–∞–≤—å—Ç–µ –¥–∞–Ω–Ω—ã–µ');
                return;
            }

            console.log('–û–±—Ä–∞–±–æ—Ç–∫–∞ —Å—Ç—Ä–æ–∫:', lines);

            // –ü–æ—Ä—è–¥–æ–∫ –ø–æ–ª–µ–π —Å–æ–≥–ª–∞—Å–Ω–æ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏
            const fieldOrder = [
                { id: 'objName', type: 'text', name: '–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞' },
                { id: 'objAddress', type: 'text', name: '–ê–¥—Ä–µ—Å' },
                { id: 'districtName', type: 'text', name: '–†–∞–π–æ–Ω' },
                { id: 'ttkStatus', type: 'select', name: '–¢–¢–ö' },
                { id: 'metroDistance', type: 'number', name: '–ú–µ—Ç—Ä–æ' },
                { id: 'rnsYear', type: 'select', name: '–ì–æ–¥ –†–ù–°' },
                { id: 'areaFlats', type: 'number', name: '–ü–ª–æ—â–∞–¥—å –∫–≤–∞—Ä—Ç–∏—Ä' },
                { id: 'areaNNP', type: 'number', name: '–ù–ù–ü' },
                { id: 'schoolCapacity', type: 'number', name: '–®–∫–æ–ª–∞' },
                { id: 'kindergartenCapacity', type: 'number', name: '–î–µ—Ç—Å–∞–¥' },
                { id: 'fact_zu_mo', type: 'number', name: '–§–∞–∫—Ç –ó–£ –ú–û', optional: true },
                { id: 'fact_zu_guest_mgn', type: 'number', name: '–§–∞–∫—Ç –ó–£ –ì–æ—Å—Ç –ú–ì–ù', optional: true },
                { id: 'fact_zu_priob_mgn', type: 'number', name: '–§–∞–∫—Ç –ó–£ –ü—Ä–∏–æ–± –ú–ì–ù', optional: true },
                { id: 'fact_uds_mo', type: 'number', name: '–§–∞–∫—Ç –£–î–° –ú–û', optional: true },
                { id: 'fact_uds_guest', type: 'number', name: '–§–∞–∫—Ç –£–î–° –ì–æ—Å—Ç', optional: true },
                { id: 'fact_uds_guest_mgn', type: 'number', name: '–§–∞–∫—Ç –£–î–° –ì–æ—Å—Ç –ú–ì–ù', optional: true },
                { id: 'fact_uds_priob', type: 'number', name: '–§–∞–∫—Ç –£–î–° –ü—Ä–∏–æ–±', optional: true },
                { id: 'fact_uds_priob_mgn', type: 'number', name: '–§–∞–∫—Ç –£–î–° –ü—Ä–∏–æ–± –ú–ì–ù', optional: true }
            ];

            let filledCount = 0;
            const filledFields = [];

            for (let i = 0; i < lines.length && i < fieldOrder.length; i++) {
                const line = lines[i];
                const field = fieldOrder[i];
                const element = document.getElementById(field.id);

                if (!element) {
                    console.log(`–ü–æ–ª–µ ${field.id} –Ω–µ –Ω–∞–π–¥–µ–Ω–æ`);
                    continue;
                }

                try {
                    let filled = false;
                    
                    if (field.type === 'select') {
                        if (field.id === 'ttkStatus') {
                            const lowerLine = line.toLowerCase();
                            if (lowerLine.includes('–≤–Ω—É—Ç—Ä') || lowerLine.includes('inside')) {
                                element.value = 'inside';
                                filled = true;
                            } else if (lowerLine.includes('—Å–Ω–∞—Ä') || lowerLine.includes('outside')) {
                                element.value = 'outside';
                                filled = true;
                            }
                        } else if (field.id === 'rnsYear') {
                            const year = line.match(/\d{4}/);
                            if (year) {
                                element.value = year[0];
                                filled = true;
                            }
                        }
                    } else if (field.type === 'number') {
                        const numValue = parseFloat(line.replace(/,/g, '.').replace(/[^\d.-]/g, ''));
                        if (!isNaN(numValue) && numValue >= 0) {
                            element.value = numValue;
                            filled = true;
                        }
                    } else {
                        // –¢–µ–∫—Å—Ç–æ–≤–æ–µ –ø–æ–ª–µ
                        element.value = line;
                        filled = true;
                        
                        // –ï—Å–ª–∏ —ç—Ç–æ –∞–¥—Ä–µ—Å, –≤—ã–∑—ã–≤–∞–µ–º –≥–µ–æ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ
                        if (field.id === 'objAddress') {
                            setTimeout(() => geocodeAddress(line), 300);
                        }
                    }

                    if (filled) {
                        filledCount++;
                        filledFields.push(`${field.name}: ${line}`);
                        console.log(`‚úì ${field.name}: ${line}`);
                    } else {
                        console.log(`‚úó ${field.name}: "${line}" –Ω–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–æ`);
                    }
                } catch (error) {
                    console.error(`–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –ø–æ–ª—è ${field.name}:`, error);
                }
            }

            closeBulkPasteModal();
            
            if (filledCount > 0) {
                alert(`‚úÖ –£—Å–ø–µ—à–Ω–æ –∑–∞–ø–æ–ª–Ω–µ–Ω–æ –ø–æ–ª–µ–π: ${filledCount}`);
                recalculate();
            } else {
                alert('‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–ø–æ–ª–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç.');
            }
        }

        // –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç—á—ë—Ç–∞ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞
        function copyReportToClipboard() {
            const resultsDiv = document.getElementById('results');
            if (!resultsDiv || !resultsDiv.innerHTML.trim()) {
                alert('‚ö†Ô∏è –°–Ω–∞—á–∞–ª–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ —Ä–∞—Å—á—ë—Ç!');
                return;
            }

            // –°–æ–∑–¥–∞—ë–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = resultsDiv.innerHTML;
            document.body.appendChild(tempDiv);

            // –ö–æ–ø–∏—Ä—É–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ
            const range = document.createRange();
            range.selectNodeContents(tempDiv);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);

            try {
                document.execCommand('copy');
                alert('‚úÖ –û—Ç—á—ë—Ç —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!');
            } catch (err) {
                alert('‚ùå –û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è: ' + err);
            }

            // –û—á–∏—â–∞–µ–º
            selection.removeAllRanges();
            document.body.removeChild(tempDiv);
        }
    </script>
</body>
</html>
