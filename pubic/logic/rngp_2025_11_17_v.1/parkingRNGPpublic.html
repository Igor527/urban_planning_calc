<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –º–∞—à–∏–Ω–æ–º–µ—Å—Ç –ø–æ ‚Ññ945-–ü–ü | Igor Chevela</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css">
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <script src="parkingCalculator.js"></script>
    <style>
        body {
            padding-top: 4rem;
        }
        .form-group {
            margin-bottom: 1rem;
        }
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }
        .results {
            margin-top: 2rem;
            padding: 1rem;
            background: var(--pico-card-background-color);
            border-radius: var(--pico-border-radius);
            overflow-x: auto;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
            font-size: 0.875rem;
        }
        table td, table th {
            border: 1px solid var(--pico-muted-border-color);
            padding: 0.5rem;
            text-align: left;
        }
        th {
            background-color: var(--pico-muted-color);
            font-weight: bold;
        }
        .section {
            margin-bottom: 1rem;
        }
        .section h4 {
            cursor: pointer;
            user-select: none;
            color: var(--pico-primary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .section h4:before {
            content: '‚ñº';
            display: inline-block;
            transition: transform 0.2s;
            font-size: 0.875rem;
        }
        .section.collapsed h4:before {
            transform: rotate(-90deg);
        }
        .section-content {
            display: block;
            margin-top: 1rem;
        }
        .section.collapsed .section-content {
            display: none;
        }
        .ui-autocomplete {
            max-height: 200px;
            overflow-y: auto;
            overflow-x: hidden;
            z-index: 1000;
        }
        .initial-values {
            margin-top: 1.5rem;
            padding: 1rem;
            background: var(--pico-code-background-color);
            border-radius: var(--pico-border-radius);
            overflow-x: auto;
        }
        .initial-values pre {
            margin: 0;
            overflow-x: auto;
            font-size: 0.875rem;
        }
        #fullAddressRow {
            margin-bottom: 1rem;
            padding: 0.75rem;
            background: var(--pico-card-background-color);
            border-radius: var(--pico-border-radius);
            border-left: 4px solid var(--pico-primary);
            font-size: 0.875rem;
        }
        #fullAddressOutput {
            font-weight: 600;
        }
        #yandexLinkContainer {
            margin-bottom: 1rem;
        }
        .yandex-card {
            padding: 1rem;
            background: var(--pico-card-background-color);
            border: 1px dashed var(--pico-muted-border-color);
            border-radius: var(--pico-border-radius);
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            justify-content: space-between;
            gap: 0.5rem;
        }
        .bulk-paste-section {
            margin-top: 1.5rem;
            padding: 1rem;
            background: var(--pico-card-background-color);
            border: 2px solid var(--pico-muted-border-color);
            border-radius: var(--pico-border-radius);
        }
        .bulk-paste-section.collapsed .bulk-paste-content-inner {
            display: none;
        }
        .bulk-paste-section h4 {
            margin: 0 0 1rem 0;
            cursor: pointer;
            user-select: none;
        }
        .bulk-paste-section h4:before {
            content: '‚ñº ';
            display: inline-block;
            transition: transform 0.2s;
        }
        .bulk-paste-section.collapsed h4:before {
            transform: rotate(-90deg);
        }
        .bulk-paste-hint {
            background: var(--pico-code-background-color);
            padding: 1rem;
            border-radius: var(--pico-border-radius);
            margin-bottom: 1rem;
            border-left: 4px solid var(--pico-primary);
        }
        .bulk-paste-hint h5 {
            margin-top: 0;
        }
        .bulk-paste-hint ol {
            margin: 0.5rem 0;
            padding-left: 1.25rem;
            line-height: 1.6;
            font-size: 0.875rem;
        }
        #bulkPasteArea {
            width: 100%;
            min-height: 200px;
            font-family: 'Courier New', monospace;
            font-size: 0.875rem;
            resize: vertical;
            margin-bottom: 1rem;
        }
        .button-group {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }
        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
            table {
                font-size: 0.75rem;
            }
            table td, table th {
                padding: 0.25rem;
            }
        }
    </style>
</head>
<body>
    <!-- Include header -->
    <div id="header-container">
        <!-- Header content will be dynamically loaded -->
    </div>

    <main class="container" style="max-width: 1400px; padding-top: 2rem; padding-bottom: 3rem;">
        <article>
            <header style="text-align: center;">
                <hgroup>
                    <h1>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –º–∞—à–∏–Ω–æ–º–µ—Å—Ç –ø–æ ‚Ññ945-–ü–ü</h1>
                    <p>–†–∞—Å—á—ë—Ç —Å—Ç–æ—è–Ω–æ–∫ –ø–æ –ü–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—é –ü—Ä–∞–≤–∏—Ç–µ–ª—å—Å—Ç–≤–∞ –ú–æ—Å–∫–≤—ã ‚Ññ945-–ü–ü –æ—Ç 23.12.2015 —Å –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏ –Ω–∞ 17 –Ω–æ—è–±—Ä—è 2025 –≥–æ–¥–∞</p>
                </hgroup>
            </header>

            <div class="button-group">
                <button class="secondary" onclick="toggleBulkPasteSection()">üìã –í—Å—Ç–∞–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ —Å–ø–∏—Å–∫–æ–º</button>
                <button class="secondary" onclick="copyReportToClipboard()">üìÑ –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –æ—Ç—á—ë—Ç</button>
            </div>

            <!-- –í—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è —Å–µ–∫—Ü–∏—è –¥–ª—è –º–∞—Å—Å–æ–≤–æ–π –≤—Å—Ç–∞–≤–∫–∏ -->
            <div id="bulkPasteSection" class="bulk-paste-section collapsed">
                <h4 onclick="toggleBulkPasteSection()">üìã –ú–∞—Å—Å–æ–≤–∞—è –≤—Å—Ç–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö</h4>
                <div class="bulk-paste-content-inner">
                    <div class="bulk-paste-hint">
                        <h5>–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ –≤—Å—Ç–∞–≤–∫–∏:</h5>
                        <ol>
                            <li>–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä: –ñ–ö '–°—Ç—Ä–æ–≥–∏–Ω–æ')</li>
                            <li>–ê–¥—Ä–µ—Å (–Ω–∞–ø—Ä–∏–º–µ—Ä: —É–ª. –ú–∞—Ä—à–∞–ª–∞ –ö–∞—Ç—É–∫–æ–≤–∞, 24)</li>
                            <li>–†–∞–π–æ–Ω (–Ω–∞–ø—Ä–∏–º–µ—Ä: –°—Ç—Ä–æ–≥–∏–Ω–æ)</li>
                            <li>–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –¢–¢–ö (–í–Ω—É—Ç—Ä–∏ –¢–¢–ö / –°–Ω–∞—Ä—É–∂–∏ –¢–¢–ö)</li>
                            <li>–£–¥–∞–ª—ë–Ω–Ω–æ—Å—Ç—å –æ—Ç –º–µ—Ç—Ä–æ (–≤ –º–µ—Ç—Ä–∞—Ö, –Ω–∞–ø—Ä–∏–º–µ—Ä: 2300)</li>
                            <li>–ì–æ–¥ –†–ù–° (–Ω–∞–ø—Ä–∏–º–µ—Ä: 2026)</li>
                            <li>–ü–ª–æ—â–∞–¥—å –∫–≤–∞—Ä—Ç–∏—Ä (–∫–≤.–º, –Ω–∞–ø—Ä–∏–º–µ—Ä: 51539.3)</li>
                            <li>–ù–µ–∂–∏–ª–∞—è –Ω–∞–∑–µ–º–Ω–∞—è –ø–ª–æ—â–∞–¥—å - –ù–ù–ü (–∫–≤.–º, –Ω–∞–ø—Ä–∏–º–µ—Ä: 4048)</li>
                            <li>–í–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —à–∫–æ–ª—ã (—á–µ–ª., –Ω–∞–ø—Ä–∏–º–µ—Ä: 1250 –∏–ª–∏ 0)</li>
                            <li>–í–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –¥–µ—Ç—Å–∫–æ–≥–æ —Å–∞–¥–∞ (—á–µ–ª., –Ω–∞–ø—Ä–∏–º–µ—Ä: 425 –∏–ª–∏ 0)</li>
                            <li style="color: var(--pico-muted-color); font-style: italic;">–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –§–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –º–µ—Å—Ç–∞ –Ω–∞ –ó–£ - –ú–û (—à—Ç.)</li>
                            <li style="color: var(--pico-muted-color); font-style: italic;">–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –§–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –º–µ—Å—Ç–∞ –Ω–∞ –ó–£ - –ì–æ—Å—Ç–µ–≤—ã–µ –ú–ì–ù (—à—Ç.)</li>
                            <li style="color: var(--pico-muted-color); font-style: italic;">–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –§–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –º–µ—Å—Ç–∞ –Ω–∞ –ó–£ - –ü—Ä–∏–æ–±—ä–µ–∫—Ç–Ω—ã–µ –ú–ì–ù (—à—Ç.)</li>
                            <li style="color: var(--pico-muted-color); font-style: italic;">–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –§–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –º–µ—Å—Ç–∞ –Ω–∞ –£–î–° - –ú–û (—à—Ç.)</li>
                            <li style="color: var(--pico-muted-color); font-style: italic;">–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –§–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –º–µ—Å—Ç–∞ –Ω–∞ –£–î–° - –ì–æ—Å—Ç–µ–≤—ã–µ (—à—Ç.)</li>
                            <li style="color: var(--pico-muted-color); font-style: italic;">–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –§–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –º–µ—Å—Ç–∞ –Ω–∞ –£–î–° - –ì–æ—Å—Ç–µ–≤—ã–µ –ú–ì–ù (—à—Ç.)</li>
                            <li style="color: var(--pico-muted-color); font-style: italic;">–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –§–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –º–µ—Å—Ç–∞ –Ω–∞ –£–î–° - –ü—Ä–∏–æ–±—ä–µ–∫—Ç–Ω—ã–µ (—à—Ç.)</li>
                            <li style="color: var(--pico-muted-color); font-style: italic;">–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –§–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –º–µ—Å—Ç–∞ –Ω–∞ –£–î–° - –ü—Ä–∏–æ–±—ä–µ–∫—Ç–Ω—ã–µ –ú–ì–ù (—à—Ç.)</li>
                        </ol>
                        <small>üí° –í—Å—Ç–∞–≤—å—Ç–µ –¥–∞–Ω–Ω—ã–µ –ø–æ—Å—Ç—Ä–æ—á–Ω–æ. –ú–æ–∂–Ω–æ –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∏–∑ Excel (–æ–¥–∏–Ω —Å—Ç–æ–ª–±–µ—Ü). –ü—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏ –∏ –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –ø–æ–ª—è –±—É–¥—É—Ç –ø—Ä–æ–ø—É—â–µ–Ω—ã.</small>
                    </div>
                    
                    <textarea id="bulkPasteArea" placeholder="–ñ–ö '–°—Ç—Ä–æ–≥–∏–Ω–æ'
—É–ª. –ú–∞—Ä—à–∞–ª–∞ –ö–∞—Ç—É–∫–æ–≤–∞, 24
–°—Ç—Ä–æ–≥–∏–Ω–æ
–°–Ω–∞—Ä—É–∂–∏ –¢–¢–ö
2300
2026
51539.3
4048
1250
425"></textarea>
                    
                    <button onclick="processBulkPaste()">‚úÖ –ü—Ä–∏–º–µ–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ</button>
                </div>
            </div>

            <div class="section">
                <h4 onclick="toggleSection(this)">–û–±—â–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã</h4>
                <div class="section-content">
                    <div class="form-group">
                        <label for="objName">–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞:</label>
                        <input type="text" id="objName" placeholder="–ù–∞–ø—Ä: –ñ–ö '–°—Ç—Ä–æ–≥–∏–Ω–æ'">
                    </div>

                    <div class="form-group">
                        <label for="objAddress">–ü–æ–∏—Å–∫ –ø–æ –∞–¥—Ä–µ—Å—É:</label>
                        <input type="text" id="objAddress" placeholder="–ù–∞–ø—Ä: —É–ª. –ú–∞—Ä—à–∞–ª–∞ –ö–∞—Ç—É–∫–æ–≤–∞, 24">
                        <small>–†–∞–π–æ–Ω –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏</small>
                    </div>

                    <div id="fullAddressRow" style="display: none;">
                        <small>–ü–æ–ª–Ω—ã–π –∞–¥—Ä–µ—Å –æ–±—ä–µ–∫—Ç–∞:</small>
                        <div id="fullAddressOutput">–û–∂–∏–¥–∞–Ω–∏–µ –≤–≤–æ–¥–∞ –∞–¥—Ä–µ—Å–∞...</div>
                    </div>

                    <div id="yandexLinkContainer"></div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="districtName">–†–∞–π–æ–Ω:</label>
                            <input type="text" id="districtName" placeholder="–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ" value="">
                        </div>

                        <div class="form-group">
                            <label for="rnsYear">–ì–æ–¥ –†–ù–°:</label>
                            <select id="rnsYear">
                                <option value="" disabled selected>–í—ã–±–µ—Ä–∏—Ç–µ –≥–æ–¥</option>
                                <option value="2025">2025</option>
                                <option value="2026">2026</option>
                                <option value="2027">2027</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –¢–¢–ö:</label>
                            <select id="ttkStatus">
                                <option value="" disabled selected>–í—ã–±–µ—Ä–∏—Ç–µ</option>
                                <option value="inside">–í–Ω—É—Ç—Ä–∏ –¢–¢–ö</option>
                                <option value="outside">–°–Ω–∞—Ä—É–∂–∏ –¢–¢–ö</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="metroDistance">–ú–µ—Ç—Ä–æ (–º–µ—Ç—Ä—ã):</label>
                            <input type="number" id="metroDistance" value="0" placeholder="0">
                        </div>
                    </div>
                </div>
            </div>

            <div class="section">
                <h4 onclick="toggleSection(this)">–ñ–∏–ª–æ–π –æ–±—ä–µ–∫—Ç</h4>
                <div class="section-content">
                    <div class="form-group">
                        <label for="areaFlats">–ü–ª–æ—â–∞–¥—å –∫–≤–∞—Ä—Ç–∏—Ä (–∫–≤.–º):</label>
                        <input type="number" id="areaFlats" value="0" step="0.1">
                    </div>
                </div>
            </div>

            <div class="section">
                <h4 onclick="toggleSection(this)">–ö–æ–º–º–µ—Ä—á–µ—Å–∫–∏–π –æ–±—ä–µ–∫—Ç</h4>
                <div class="section-content">
                    <div class="form-group">
                        <label for="areaNNP">–ù–µ–∂–∏–ª–∞—è –Ω–∞–∑–µ–º–Ω–∞—è –ø–ª–æ—â–∞–¥—å (–∫–≤.–º):</label>
                        <input type="number" id="areaNNP" value="0" step="0.1">
                    </div>
                </div>
            </div>

            <div class="section">
                <h4 onclick="toggleSection(this)">–û–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ —É—á—Ä–µ–∂–¥–µ–Ω–∏—è</h4>
                <div class="section-content">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="schoolCapacity">–®–∫–æ–ª–∞ (—á–µ–ª.):</label>
                            <input type="number" id="schoolCapacity" value="0">
                        </div>
                        <div class="form-group">
                            <label for="kindergartenCapacity">–î–µ—Ç—Å–∫–∏–π —Å–∞–¥ (—á–µ–ª.):</label>
                            <input type="number" id="kindergartenCapacity" value="0">
                        </div>
                    </div>
                </div>
            </div>

            <div class="section">
                <h4 onclick="toggleSection(this)">–§–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –º–µ—Å—Ç–∞</h4>
                <div class="section-content">
                    <div style="margin-bottom: 1rem;">
                        <label style="font-weight: bold;">–ù–∞ —É—á–∞—Å—Ç–∫–µ (–ó–£):</label>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="fact_zu_mo">–ú–µ—Å—Ç–∞ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏:</label>
                                <input type="number" id="fact_zu_mo" value="0">
                            </div>
                            <div class="form-group">
                                <label for="fact_zu_guest_mgn">–ì–æ—Å—Ç–µ–≤—ã–µ –ú–ì–ù:</label>
                                <input type="number" id="fact_zu_guest_mgn" value="0">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="fact_zu_priob_mgn">–ü—Ä–∏–æ–±—ä–µ–∫—Ç–Ω—ã–µ –ú–ì–ù:</label>
                            <input type="number" id="fact_zu_priob_mgn" value="0">
                        </div>
                    </div>

                    <div>
                        <label style="font-weight: bold;">–ù–∞ –£–î–°:</label>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="fact_uds_mo">–ú–µ—Å—Ç–∞ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏:</label>
                                <input type="number" id="fact_uds_mo" value="0">
                            </div>
                            <div class="form-group">
                                <label for="fact_uds_guest">–ì–æ—Å—Ç–µ–≤—ã–µ:</label>
                                <input type="number" id="fact_uds_guest" value="0">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="fact_uds_guest_mgn">–ì–æ—Å—Ç–µ–≤—ã–µ –ú–ì–ù:</label>
                                <input type="number" id="fact_uds_guest_mgn" value="0">
                            </div>
                            <div class="form-group">
                                <label for="fact_uds_priob">–ü—Ä–∏–æ–±—ä–µ–∫—Ç–Ω—ã–µ:</label>
                                <input type="number" id="fact_uds_priob" value="0">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="fact_uds_priob_mgn">–ü—Ä–∏–æ–±—ä–µ–∫—Ç–Ω—ã–µ –ú–ì–ù:</label>
                            <input type="number" id="fact_uds_priob_mgn" value="0">
                        </div>
                    </div>
                </div>
            </div>

            <div class="initial-values">
                <h4>–ò—Å—Ö–æ–¥–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:</h4>
                <pre id="initialValues">–î–∞–Ω–Ω—ã–µ –Ω–µ –∑–∞–ø–æ–ª–Ω–µ–Ω—ã</pre>
            </div>

            <div class="results" id="results"></div>
        </article>
    </main>

    <!-- Include footer -->
    <div id="footer-container">
        <!-- Footer content will be dynamically loaded -->
    </div>

    <script src="../../main/shared.js"></script>
    <script>
        // –§—É–Ω–∫—Ü–∏—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –≤–∏–¥–∏–º–æ—Å—Ç–∏ —Å–µ–∫—Ü–∏–π
        function toggleSection(header) {
            const section = header.closest('.section');
            section.classList.toggle('collapsed');
        }

        $(function() {
            const districts = Object.keys(parkingData.districts);
            $("#districtName").autocomplete({
                source: districts
            });
            
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ—Å—á–µ—Ç –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ª—é–±–æ–≥–æ –ø–æ–ª—è
            $('input, select').on('input change', function() {
                recalculate();
            });

            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–≤–æ–¥–∞ –∞–¥—Ä–µ—Å–∞ —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π –¥–ª—è –∞–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ä–∞–π–æ–Ω–∞
            let addressTimeout;
            $('#objAddress').on('input', function() {
                clearTimeout(addressTimeout);
                const address = $(this).val().trim();
                
                if (address.length > 3) {
                    addressTimeout = setTimeout(() => {
                        geocodeAddress(address);
                    }, 500);
                } else {
                    $('#fullAddressRow').hide();
                    $('#yandexLinkContainer').empty();
                }
            });
        });

        // –§—É–Ω–∫—Ü–∏—è –≥–µ–æ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è –∞–¥—Ä–µ—Å–∞ —á–µ—Ä–µ–∑ –Ø–Ω–¥–µ–∫—Å API
        async function geocodeAddress(address) {
            try {
                const encodedAddress = encodeURIComponent('–ú–æ—Å–∫–≤–∞, ' + address);
                
                const searchUrl = `https://yandex.ru/maps/?text=${encodedAddress}`;
                $('#yandexLinkContainer').html(`
                    <div class="yandex-card">
                        <span>üìç –ù–∞–π—Ç–∏ –∞–¥—Ä–µ—Å –Ω–∞ –∫–∞—Ä—Ç–µ</span>
                        <a href="${searchUrl}" target="_blank" role="button" class="secondary outline" style="margin: 0;">–Ø–Ω–¥–µ–∫—Å.–ö–∞—Ä—Ç—ã</a>
                    </div>
                `);
                $('#fullAddressOutput').text('–í–≤–µ–¥–µ–Ω –∞–¥—Ä–µ—Å: ' + address);
                $('#fullAddressRow').show();
                
                const districts = Object.keys(parkingData.districts);
                const matchingDistrict = districts.find(d => 
                    address.toLowerCase().includes(d.toLowerCase())
                );
                
                if (matchingDistrict && !$('#districtName').val()) {
                    $('#districtName').val(matchingDistrict);
                    $('#districtName').trigger('change');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∞–¥—Ä–µ—Å–∞:', error);
            }
        }

        function recalculate() {
            const districtName = document.getElementById('districtName').value;
            const ttkStatus = document.getElementById('ttkStatus').value;
            const metroDistance = parseFloat(document.getElementById('metroDistance').value);
            const rnsYear = parseInt(document.getElementById('rnsYear').value);

            const inputData = {
                objName: document.getElementById('objName').value,
                districtName: districtName,
                ttkStatus: ttkStatus,
                metroDistance: metroDistance,
                rnsYear: rnsYear,
                areaFlats: parseFloat(document.getElementById('areaFlats').value),
                areaNNP: parseFloat(document.getElementById('areaNNP').value),
                schoolCapacity: parseInt(document.getElementById('schoolCapacity').value),
                kindergartenCapacity: parseInt(document.getElementById('kindergartenCapacity').value),
                fact_zu_mo: parseInt(document.getElementById('fact_zu_mo').value),
                fact_zu_guest_mgn: parseInt(document.getElementById('fact_zu_guest_mgn').value),
                fact_zu_priob_mgn: parseInt(document.getElementById('fact_zu_priob_mgn').value),
                fact_uds_mo: parseInt(document.getElementById('fact_uds_mo').value),
                fact_uds_guest: parseInt(document.getElementById('fact_uds_guest').value),
                fact_uds_guest_mgn: parseInt(document.getElementById('fact_uds_guest_mgn').value),
                fact_uds_priob: parseInt(document.getElementById('fact_uds_priob').value),
                fact_uds_priob_mgn: parseInt(document.getElementById('fact_uds_priob_mgn').value)
            };

            const calculator = new ParkingCalculator(inputData);
            calculator.calculate();
            const report = calculator.getFormattedReport();

            document.getElementById('results').innerHTML = report;
            
            // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –≤—ã–≤–æ–¥ –∏—Å—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
            const objName = document.getElementById('objName').value;
            const objAddress = document.getElementById('objAddress').value;
            let formattedData = '';
            
            if (objName) formattedData += `–û–±—ä–µ–∫—Ç: ${objName}\n`;
            if (objAddress) formattedData += `–ê–¥—Ä–µ—Å: ${objAddress}\n`;
            if (districtName) formattedData += `–†–∞–π–æ–Ω: ${districtName}\n`;
            if (ttkStatus) formattedData += `–¢–¢–ö: ${ttkStatus === 'inside' ? '–í–Ω—É—Ç—Ä–∏' : '–°–Ω–∞—Ä—É–∂–∏'}\n`;
            if (!isNaN(metroDistance)) formattedData += `–ú–µ—Ç—Ä–æ: ${metroDistance} –º\n`;
            if (!isNaN(rnsYear)) formattedData += `–ì–æ–¥ –†–ù–°: ${rnsYear}\n`;
            if (!isNaN(inputData.areaFlats) && inputData.areaFlats > 0) formattedData += `–ü–ª–æ—â–∞–¥—å –∫–≤–∞—Ä—Ç–∏—Ä: ${inputData.areaFlats} –∫–≤.–º\n`;
            if (!isNaN(inputData.areaNNP) && inputData.areaNNP > 0) formattedData += `–ù–ù–ü: ${inputData.areaNNP} –∫–≤.–º\n`;
            if (!isNaN(inputData.schoolCapacity) && inputData.schoolCapacity > 0) formattedData += `–®–∫–æ–ª–∞: ${inputData.schoolCapacity} —á–µ–ª.\n`;
            if (!isNaN(inputData.kindergartenCapacity) && inputData.kindergartenCapacity > 0) formattedData += `–î–µ—Ç—Å–∞–¥: ${inputData.kindergartenCapacity} —á–µ–ª.\n`;
            
            const hasFacts = inputData.fact_zu_mo || inputData.fact_zu_guest_mgn || inputData.fact_zu_priob_mgn ||
                            inputData.fact_uds_mo || inputData.fact_uds_guest || inputData.fact_uds_guest_mgn ||
                            inputData.fact_uds_priob || inputData.fact_uds_priob_mgn;
            
            if (hasFacts) {
                formattedData += `\n–§–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –º–µ—Å—Ç–∞:\n`;
                if (inputData.fact_zu_mo) formattedData += `  –ó–£ –ú–û: ${inputData.fact_zu_mo} —à—Ç.\n`;
                if (inputData.fact_zu_guest_mgn) formattedData += `  –ó–£ –ì–æ—Å—Ç–µ–≤—ã–µ –ú–ì–ù: ${inputData.fact_zu_guest_mgn} —à—Ç.\n`;
                if (inputData.fact_zu_priob_mgn) formattedData += `  –ó–£ –ü—Ä–∏–æ–±—ä–µ–∫—Ç–Ω—ã–µ –ú–ì–ù: ${inputData.fact_zu_priob_mgn} —à—Ç.\n`;
                if (inputData.fact_uds_mo) formattedData += `  –£–î–° –ú–û: ${inputData.fact_uds_mo} —à—Ç.\n`;
                if (inputData.fact_uds_guest) formattedData += `  –£–î–° –ì–æ—Å—Ç–µ–≤—ã–µ: ${inputData.fact_uds_guest} —à—Ç.\n`;
                if (inputData.fact_uds_guest_mgn) formattedData += `  –£–î–° –ì–æ—Å—Ç–µ–≤—ã–µ –ú–ì–ù: ${inputData.fact_uds_guest_mgn} —à—Ç.\n`;
                if (inputData.fact_uds_priob) formattedData += `  –£–î–° –ü—Ä–∏–æ–±—ä–µ–∫—Ç–Ω—ã–µ: ${inputData.fact_uds_priob} —à—Ç.\n`;
                if (inputData.fact_uds_priob_mgn) formattedData += `  –£–î–° –ü—Ä–∏–æ–±—ä–µ–∫—Ç–Ω—ã–µ –ú–ì–ù: ${inputData.fact_uds_priob_mgn} —à—Ç.\n`;
            }
            
            document.getElementById('initialValues').textContent = formattedData || '–î–∞–Ω–Ω—ã–µ –Ω–µ –∑–∞–ø–æ–ª–Ω–µ–Ω—ã';
        }

        window.onload = function() {
            recalculate();
        };

        function toggleBulkPasteSection() {
            const section = document.getElementById('bulkPasteSection');
            section.classList.toggle('collapsed');
        }

        function processBulkPaste() {
            const text = document.getElementById('bulkPasteArea').value;
            const lines = text.split(/\r?\n/).map(line => line.trim()).filter(line => line);
            
            if (lines.length === 0) {
                alert('‚ö†Ô∏è –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—Å—Ç–∞–≤—å—Ç–µ –¥–∞–Ω–Ω—ã–µ');
                return;
            }

            const fieldOrder = [
                { id: 'objName', type: 'text', name: '–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞' },
                { id: 'objAddress', type: 'text', name: '–ê–¥—Ä–µ—Å' },
                { id: 'districtName', type: 'text', name: '–†–∞–π–æ–Ω' },
                { id: 'ttkStatus', type: 'select', name: '–¢–¢–ö' },
                { id: 'metroDistance', type: 'number', name: '–ú–µ—Ç—Ä–æ' },
                { id: 'rnsYear', type: 'select', name: '–ì–æ–¥ –†–ù–°' },
                { id: 'areaFlats', type: 'number', name: '–ü–ª–æ—â–∞–¥—å –∫–≤–∞—Ä—Ç–∏—Ä' },
                { id: 'areaNNP', type: 'number', name: '–ù–ù–ü' },
                { id: 'schoolCapacity', type: 'number', name: '–®–∫–æ–ª–∞' },
                { id: 'kindergartenCapacity', type: 'number', name: '–î–µ—Ç—Å–∞–¥' },
                { id: 'fact_zu_mo', type: 'number', name: '–§–∞–∫—Ç –ó–£ –ú–û', optional: true },
                { id: 'fact_zu_guest_mgn', type: 'number', name: '–§–∞–∫—Ç –ó–£ –ì–æ—Å—Ç –ú–ì–ù', optional: true },
                { id: 'fact_zu_priob_mgn', type: 'number', name: '–§–∞–∫—Ç –ó–£ –ü—Ä–∏–æ–± –ú–ì–ù', optional: true },
                { id: 'fact_uds_mo', type: 'number', name: '–§–∞–∫—Ç –£–î–° –ú–û', optional: true },
                { id: 'fact_uds_guest', type: 'number', name: '–§–∞–∫—Ç –£–î–° –ì–æ—Å—Ç', optional: true },
                { id: 'fact_uds_guest_mgn', type: 'number', name: '–§–∞–∫—Ç –£–î–° –ì–æ—Å—Ç –ú–ì–ù', optional: true },
                { id: 'fact_uds_priob', type: 'number', name: '–§–∞–∫—Ç –£–î–° –ü—Ä–∏–æ–±', optional: true },
                { id: 'fact_uds_priob_mgn', type: 'number', name: '–§–∞–∫—Ç –£–î–° –ü—Ä–∏–æ–± –ú–ì–ù', optional: true }
            ];

            let filledCount = 0;

            for (let i = 0; i < lines.length && i < fieldOrder.length; i++) {
                const line = lines[i];
                const field = fieldOrder[i];
                const element = document.getElementById(field.id);

                if (!element) continue;

                try {
                    let filled = false;
                    
                    if (field.type === 'select') {
                        if (field.id === 'ttkStatus') {
                            const lowerLine = line.toLowerCase();
                            if (lowerLine.includes('–≤–Ω—É—Ç—Ä') || lowerLine.includes('inside')) {
                                element.value = 'inside';
                                filled = true;
                            } else if (lowerLine.includes('—Å–Ω–∞—Ä') || lowerLine.includes('outside')) {
                                element.value = 'outside';
                                filled = true;
                            }
                        } else if (field.id === 'rnsYear') {
                            const year = line.match(/\d{4}/);
                            if (year) {
                                element.value = year[0];
                                filled = true;
                            }
                        }
                    } else if (field.type === 'number') {
                        const numValue = parseFloat(line.replace(/,/g, '.').replace(/[^\d.-]/g, ''));
                        if (!isNaN(numValue) && numValue >= 0) {
                            element.value = numValue;
                            filled = true;
                        }
                    } else {
                        element.value = line;
                        filled = true;
                        
                        if (field.id === 'objAddress') {
                            setTimeout(() => geocodeAddress(line), 300);
                        }
                    }

                    if (filled) {
                        filledCount++;
                    }
                } catch (error) {
                    console.error(`–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –ø–æ–ª—è ${field.name}:`, error);
                }
            }

            toggleBulkPasteSection();
            
            if (filledCount > 0) {
                alert(`‚úÖ –£—Å–ø–µ—à–Ω–æ –∑–∞–ø–æ–ª–Ω–µ–Ω–æ –ø–æ–ª–µ–π: ${filledCount}`);
                recalculate();
            } else {
                alert('‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–ø–æ–ª–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç.');
            }
        }

        function copyReportToClipboard() {
            const resultsDiv = document.getElementById('results');
            if (!resultsDiv || !resultsDiv.innerHTML.trim()) {
                alert('‚ö†Ô∏è –°–Ω–∞—á–∞–ª–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ —Ä–∞—Å—á—ë—Ç!');
                return;
            }

            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = resultsDiv.innerHTML;
            document.body.appendChild(tempDiv);

            const range = document.createRange();
            range.selectNodeContents(tempDiv);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);

            try {
                document.execCommand('copy');
                alert('‚úÖ –û—Ç—á—ë—Ç —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!');
            } catch (err) {
                alert('‚ùå –û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è: ' + err);
            }

            selection.removeAllRanges();
            document.body.removeChild(tempDiv);
        }

        // Dynamically load header and footer
        fetch('../../main/header.html').then(response => response.text()).then(data => {
            document.getElementById('header-container').innerHTML = data;
            if (typeof initializeHeaderFooter === 'function') {
                initializeHeaderFooter();
            } else {
                setTimeout(() => {
                    if (typeof applyTheme === 'function') applyTheme();
                    if (typeof applyLanguage === 'function') applyLanguage();
                }, 100);
            }
        }).catch(err => console.error('Error loading header:', err));

        fetch('../../main/footer.html').then(response => response.text()).then(data => {
            document.getElementById('footer-container').innerHTML = data;
            if (typeof applyLanguage === 'function') applyLanguage();
        }).catch(err => console.error('Error loading footer:', err));
    </script>
</body>
</html>
